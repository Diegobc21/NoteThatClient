<div *ngIf="spinnerService.showSpinner">
  <div *ngFor="let i of [].constructor(3)" class="border border-blue-300 shadow rounded-md mt-4 p-4 w-full">
    <div class="animate-pulse flex space-x-4">
      <div class="flex-1 space-y-6 py-1">
        <div class="h-2 bg-slate-700 rounded"></div>
        <div class="space-y-3">
          <div class="grid grid-cols-3 gap-4">
            <div class="h-2 bg-slate-700 rounded col-span-2"></div>
            <div class="h-2 bg-slate-700 rounded col-span-1"></div>
          </div>
          <div class="h-2 bg-slate-700 rounded"></div>
        </div>
      </div>
    </div>
  </div>
</div>

<app-popup-menu *ngIf="popupEnabled"
                (emittedOption)="handlePopupOption($event)"
                [popupPosition]="getPopupPosition()"
                [options]="popupOptions"
></app-popup-menu>

<div *ngIf="!spinnerService.showSpinner">
  <div class="max-w-screen-xl mx-auto">
    <div class="flex flex-row justify-between relative">
      <button (click)="goToHome()"
              class="bg-gray-700 hover:bg-gray-400 transition-all
              text-white font-bold py-2 px-4 rounded">
        Inicio
      </button>
      <button (click)="toggleIsAddingNote()"
              class="bg-gradient-to-r to-green-500 via-blue-500 from-purple-600 hover:bg-blue-700
    text-white font-bold py-2 px-4 rounded block sm:inline-block">
        {{isAddingNote ? 'Cancelar' : 'Añadir nota'}}
      </button>
    </div>
  </div>

  <div [@slideDown]="isAddingNote ? 'visible' : 'hidden'"
       [@slideUp]="isAddingNote ? 'visible' : 'hidden'"
       class="overflow-hidden">
    <div
      class="rounded-xl bg-gradient-to-r from-green-300 via-blue-500 to-purple-600 p-0.5 shadow-xl transition hover:shadow-sm mt-4">
      <div class="rounded-[10px] bg-gray-800 p-4 sm:p-6">

        <h1 class="text-2xl font-bold text-white mb-2">Nueva nota</h1>
        <form (ngSubmit)="submitNote()">
          <input autofocus
                 class="bg-gray-800 text-white placeholder-gray-400 px-4 py-2 rounded-md mb-4 w-full focus:outline-none focus:bg-gray-700 hover:bg-gray-700"
                 type="text" placeholder="*Título" [(ngModel)]="newNote.title" required>
          <div class="flex flex-col">
              <textarea
                class="bg-gray-800 text-white placeholder-gray-400 px-4 py-2 rounded-md mb-2 focus:outline-none focus:bg-gray-700 hover:bg-gray-700"
                rows="3" placeholder="Contenido" [(ngModel)]="newNote.content"></textarea>
            <button
              class="self-end bg-purple-500 hover:bg-purple-700 disabled:bg-gray-400 text-white font-bold py-2 px-4 rounded"
              type="submit" [disabled]="addingFormIsEmpty">
              Crear
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
  <div *ngFor="let note of noteList">

    <!--    Organización por fecha-->
    <!--    <div *ngIf="!isEditingNote" class="bg-gray-800 py-2">-->
    <!--      <div class="container mx-auto text-white text-center relative">-->
    <!--        <div class="absolute left-0 top-1/2 w-1/3">-->
    <!--          <div class="h-px bg-gray-600"></div>-->
    <!--        </div>-->
    <!--        <h2 class="text-lg font-semibold bg-gray-800 inline-block px-4">-->
    <!--          {{getMonth(note)}}-->
    <!--        </h2>-->
    <!--        <div class="absolute right-0 top-1/2 w-1/3">-->
    <!--          <div class="h-px bg-gray-600"></div>-->
    <!--        </div>-->
    <!--      </div>-->
    <!--    </div>-->

    <!--  Normal note  -->
    <div *ngIf="!isEditingNote" (click)="toggleEditing(note, $event)" id="note"
         class="rounded-xl bg-gradient-to-r from-green-300 via-blue-500 to-purple-600
       p-0.5 shadow-xl transition hover:shadow-sm mt-4 is-note"
    >
      <div class="rounded-[10px] bg-gray-800 p-4 sm:p-6">
        <time class="block text-xs text-gray-300">
          {{getNoteDate(note.creationDate)}}
        </time>
        <div class="flex flex-row justify-between">
          <div>
            <h3 class="mt-0.5 text-lg font-bold text-white">
              {{note.title}}
            </h3>

            <h4 class="mt-0.5 text-sm font-medium text-white">
              {{note.content}}
            </h4>
          </div>
        </div>
      </div>
    </div>

  </div>

  <!--  Editing note  -->
  <div *ngIf="isEditingNote">
    <div [@slideDown]="isEditingNote ? 'visible' : 'hidden'"
         class="overflow-hidden transition-all duration-500">
      <div *ngIf="isEditingNote"
           class="rounded-xl bg-gradient-to-r from-green-300 via-blue-500 to-purple-600 p-0.5 shadow-xl transition hover:shadow-sm mt-4">
        <div class="rounded-[10px] bg-gray-800 p-4 sm:p-6">
          <h1 class="text-2xl font-bold text-white mb-2">Editar nota</h1>
          <form (ngSubmit)="submitEditing()">
            <input #editingTitle autofocus
                   class="bg-gray-800 text-white placeholder-gray-400 px-4 py-2 rounded-md mb-4 w-full focus:outline-none focus:bg-gray-700 hover:bg-gray-700"
                   type="text" placeholder="Título (obligatorio)*" [value]="editingNote.title" required>
            <div class="flex flex-col">
              <textarea #editingContent
                        class="bg-gray-800 text-white placeholder-gray-400 px-4 py-2 rounded-md mb-2 focus:outline-none focus:bg-gray-700  hover:bg-gray-700"
                        rows="3" placeholder="Contenido" [value]="editingNote.content"></textarea>
              <div class="self-end">
                <button
                  class="bg-purple-500 mr-2 hover:bg-purple-700 disabled:bg-gray-400 text-white font-bold py-2 px-4 rounded"
                  type="submit" [disabled]="editingFormIsEmpty">
                  Guardar
                </button>
                <button (click)="toggleIsEditingNote()"
                        class="bg-gradient-to-r to-red-500 via-orange-500 from-yellow-600 hover:bg-blue-700
                        text-white font-bold py-2 px-4 rounded self-end">
                  Cancelar
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <div class="mt-4">
    <app-alert
      *ngIf="showAlert"
      [type]="AlertType.WARNING"
      (onClose)="modalClosed()"
      [message]="'Aún no tienes ninguna nota'">
    </app-alert>
  </div>
</div>
